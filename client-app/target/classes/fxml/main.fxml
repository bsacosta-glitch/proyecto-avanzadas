<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/11.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.messaging.client.controller.MainController">
   <top>
      <MenuBar BorderPane.alignment="CENTER">
         <menus>
            <Menu mnemonicParsing="false" text="Archivo">
               <items>
                  <MenuItem mnemonicParsing="false" onAction="#handleExit" text="Salir" />
               </items>
            </Menu>
            <Menu mnemonicParsing="false" text="Herramientas">
               <items>
                  <MenuItem mnemonicParsing="false" onAction="#handleSettings" text="ConfiguraciÃ³n" />
               </items>
            </Menu>
            <Menu mnemonicParsing="false" text="Ayuda">
               <items>
                  <MenuItem mnemonicParsing="false" onAction="#handleAbout" text="Acerca de" />
               </items>
            </Menu>
         </menus>
      </MenuBar>
   </top>
   <center>
      <StackPane>
         <!-- Panel de Login -->
         <VBox fx:id="loginPane" alignment="CENTER" spacing="20.0" styleClass="login-pane">
            <children>
               <Label styleClass="app-title" text="Sistema de MensajerÃ­a" />
               <VBox alignment="CENTER" spacing="10.0">
                  <children>
                     <TextField fx:id="usernameField" maxWidth="300.0" promptText="Nombre de usuario" />
                     <PasswordField fx:id="passwordField" maxWidth="300.0" promptText="ContraseÃ±a" />
                     <HBox alignment="CENTER" spacing="10.0">
                        <children>
                           <Button fx:id="loginButton" onAction="#handleLogin" text="Iniciar SesiÃ³n" />
                           <Button fx:id="registerButton" onAction="#handleRegister" text="Registrarse" />
                        </children>
                     </HBox>
                     <Label fx:id="loginStatusLabel" styleClass="status-label" />
                  </children>
               </VBox>
            </children>
         </VBox>
         
         <!-- Panel de Chat -->
         <VBox fx:id="chatPane" visible="false">
            <children>
               <!-- Barra superior -->
               <HBox alignment="CENTER_LEFT" spacing="10.0" styleClass="top-bar">
                  <children>
                     <Label fx:id="welcomeLabel" styleClass="welcome-label" />
                     <Region HBox.hgrow="ALWAYS" />
                     <Label fx:id="connectionStatusLabel" styleClass="connection-status" />
                  </children>
               </HBox>
               
               <!-- Contenido principal - Estilo WhatsApp -->
               <HBox spacing="0" VBox.vgrow="ALWAYS">
                  <!-- Panel izquierdo - Lista de usuarios -->
                  <VBox prefWidth="300" styleClass="users-sidebar">
                     <children>
                        <!-- Cabecera de usuarios -->
                        <HBox alignment="CENTER_LEFT" spacing="10.0" styleClass="sidebar-header">
                           <padding><Insets top="10" right="10" bottom="10" left="10" /></padding>
                           <children>
                              <Label text="Chats" styleClass="sidebar-title" />
                              <Region HBox.hgrow="ALWAYS" />
                              <Button text="ðŸ”„" onAction="#handleRefreshUsers" styleClass="icon-button" />
                           </children>
                        </HBox>
                        
                        <!-- Buscador -->
                        <TextField fx:id="searchUserField" promptText="ðŸ” Buscar usuario..." styleClass="search-field">
                           <VBox.margin><Insets top="5" right="10" bottom="5" left="10" /></VBox.margin>
                        </TextField>
                        
                        <!-- Lista de usuarios conectados -->
                        <ListView fx:id="usersListView" styleClass="users-list" VBox.vgrow="ALWAYS">
                           <VBox.margin><Insets top="5" right="0" bottom="0" left="0" /></VBox.margin>
                        </ListView>
                     </children>
                  </VBox>
                  
                  <!-- Panel derecho - Chat activo -->
                  <VBox HBox.hgrow="ALWAYS" styleClass="chat-container">
                     <children>
                        <!-- Cabecera del chat con info del usuario seleccionado -->
                        <HBox fx:id="chatHeader" alignment="CENTER_LEFT" spacing="15.0" styleClass="chat-header" visible="false">
                           <padding><Insets top="15" right="20" bottom="15" left="20" /></padding>
                           <children>
                              <VBox spacing="3">
                                 <children>
                                    <Label fx:id="selectedUserLabel" styleClass="chat-user-name" text="Usuario" />
                                    <Label fx:id="userStatusLabel" styleClass="chat-user-status" text="Seleccione un usuario" />
                                 </children>
                              </VBox>
                              <Region HBox.hgrow="ALWAYS" />
                              <Label fx:id="onlineIndicator" text="â— En lÃ­nea" styleClass="online-status" visible="false" />
                           </children>
                        </HBox>
                        
                        <Separator />
                        
                        <!-- Ãrea de mensajes del chat -->
                        <ScrollPane fx:id="messagesScrollPane" fitToWidth="true" styleClass="messages-scroll" VBox.vgrow="ALWAYS">
                           <VBox fx:id="messagesContainer" spacing="10" styleClass="messages-area">
                              <padding><Insets top="15" right="15" bottom="15" left="15" /></padding>
                           </VBox>
                        </ScrollPane>
                        
                        <!-- Panel de entrada de mensaje -->
                        <VBox fx:id="messageInputPanel" spacing="0" styleClass="message-input-panel" visible="false">
                           <Separator />
                           <HBox alignment="CENTER" spacing="10.0">
                              <padding><Insets top="15" right="15" bottom="15" left="15" /></padding>
                              <children>
                                 <Button fx:id="sendFileButton" onAction="#handleSendFile" text="ðŸ“Ž" styleClass="icon-button" />
                                 <TextArea fx:id="messageTextArea" prefRowCount="2" wrapText="true" 
                                          promptText="Escribe un mensaje..." styleClass="message-input" HBox.hgrow="ALWAYS" />
                                 <Button fx:id="sendMessageButton" onAction="#handleSendMessage" text="âž¤" styleClass="send-button" />
                              </children>
                           </HBox>
                        </VBox>
                        
                        <!-- Mensaje cuando no hay usuario seleccionado -->
                        <VBox fx:id="noSelectionPane" alignment="CENTER" VBox.vgrow="ALWAYS" styleClass="no-selection-pane">
                           <children>
                              <Label text="ðŸ’¬" styleClass="empty-icon" />
                              <Label text="Selecciona un usuario para comenzar a chatearrr" styleClass="empty-message" />
                           </children>
                        </VBox>
                     </children>
                  </VBox>
               </HBox>
            </children>
         </VBox>
      </StackPane>
   </center>
   <bottom>
      <HBox alignment="CENTER_LEFT" spacing="10.0" styleClass="status-bar">
         <children>
            <Label text="Estado:" />
            <Label fx:id="statusLabel" text="Listo" />
            <Region HBox.hgrow="ALWAYS" />
            <Label text="Sistema de MensajerÃ­a v1.0" />
         </children>
      </HBox>
   </bottom>
</BorderPane>
